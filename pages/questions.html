<div class="card" role="main">
  <h1>Quiz Time!</h1>
  <p id="question" class="question">Loading question...</p>

  <input id="answerInput" type="text" placeholder="Type your answer here" />

  <div class="controls">
    <button id="submitBtn" class="primary">Submit</button>
    <button id="newBtn">Next Question</button>
    <button id="addBtn">Add Question</button>
  </div>

  <p id="feedback" class="feedback"></p>
</div>

<script>
let currentAnswer = "";

// Load a new question
async function getQuestion() {
  const res = await fetch('/question', {method: 'POST'});
  const data = await res.json();
  document.getElementById('question').textContent = data.question;
  currentAnswer = data.answer.trim(); // keep original for feedback
  document.getElementById('feedback').textContent = "";
  document.getElementById('answerInput').value = "";
}

// Check the answer
function checkAnswer() {
  const user = document.getElementById('answerInput').value.trim();
  const feedback = document.getElementById('feedback');
  if (!user) return;

  // Case-insensitive comparison
  if (user.toLowerCase() === currentAnswer.toLowerCase()) {
    feedback.textContent = "✅ Correct!";
    feedback.style.color = "green";
  } else {
    feedback.textContent = `❌ Incorrect! The correct answer is: ${currentAnswer}`;
    feedback.style.color = "red";
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('answerInput');
  const submitBtn = document.getElementById('submitBtn');

  // Click submit button
  submitBtn.addEventListener('click', checkAnswer);

  // Press Enter key in input field to submit
  input.addEventListener('keydown', (e) => {
    if (e.key === "Enter") {
      e.preventDefault();  // prevent default line break
      checkAnswer();
    }
  });

  document.getElementById('newBtn').addEventListener('click', getQuestion);
  document.getElementById('addBtn').addEventListener('click', async () => {
    const q = prompt("Enter a new question:");
    if (!q) return;
    const a = prompt("Enter the answer:");
    if (!a) return;
    const res = await fetch('/add_question', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({question: q, answer: a})
    });
    const data = await res.json();
    alert(data.ok ? "Added!" : ("Failed: " + data.error));
  });

  getQuestion();  // load first question
});
</script>
